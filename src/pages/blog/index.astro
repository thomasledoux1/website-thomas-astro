---
import { getCollection } from 'astro:content';
import PostPreview from '../../components/PostPreview.astro';
import Tags from '../../components/Tags.astro';
const allBlogPosts = await getCollection(
  'blog',
  blog => blog.data.draft !== true
);
import Layout from '../../layouts/Layout.astro';
const tags = allBlogPosts
  .map(blog => blog.data.tags)
  .flat()
  .reduce<{ [key: string]: number }>(function (result, c) {
    var count = result[c] || 0;
    result[c] = count + 1;
    return result;
  }, {});
const sortedPosts = allBlogPosts.sort(
  (a, b) => +new Date(b.data.date) - +new Date(a.data.date)
);
---

<Layout title="The Thomas Ledoux blog">
  <!-- Subtle background elements -->
  <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
    <div
      class="absolute inset-0 bg-gradient-to-b from-transparent via-primary/5 to-transparent"
    >
    </div>
  </div>

  <section class="my-auto lg:mt-8">
    <div class="relative">
      <div class="mb-10 text-center">
        <h1
          class="text-4xl lg:text-7xl xl:text-8xl font-bold mb-6 tracking-tight font-title"
        >
          Blog
        </h1>
        <p
          class="text-lg lg:text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed"
        >
          Thoughts, tutorials, and insights on web development, frameworks, and
          the latest technologies.
        </p>
      </div>

      <div class="mb-10" data-pagefind-ignore="all">
        <h2 class="text-2xl font-bold mb-4 text-gray-900">Tags</h2>
        <Tags tags={tags} />
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
        {sortedPosts.map((post, i) => <PostPreview {post} index={i} />)}
      </div>
    </div>
  </section>
</Layout>
